<div class="m-4 mt-0 ml-0">
  <div class="mx-auto w-full bg-white rounded-3xl p-4">
    <div class="flex justify-end items-center mb-4">
      <div class="flex items-center gap-4 text-sm">
        <phds-select 
          [placeholder]="'Status'" 
          [options]="statusOptions" 
          [selectedValue]="selectedStatus" 
          (valueChange)="onStatusChange($event)" 
        />
        <phds-select 
          [placeholder]="'Prioridade'" 
          [options]="priorityOptions" 
          [selectedValue]="selectedPriority" 
          (valueChange)="onPriorityChange($event)"
        />
      </div>
    </div>
    <div class="overflow-x-auto border border-b-0 rounded-2xl rounded-b-none">
      <table class="table-auto border-collapse overflow-hidden w-full rounded-t-xl">
        <thead>
          <tr class="h-10">
            <th class="px-4 text-xs font-bold text-gray-600 text-left"><input type="checkbox" class="align-middle" (change)="toggleAll($event)"></th>
            <th class="px-4 text-xs font-bold text-gray-600 text-left whitespace-nowrap">ID</th>
            <th class="px-4 text-xs font-bold text-gray-600 text-left w-full">Assunto</th>
            <th class="px-4 text-xs font-bold text-gray-600 text-left whitespace-nowrap hidden md:table-cell">Criado em</th>
            <th class="px-4 text-xs font-bold text-gray-600 text-left whitespace-nowrap hidden md:table-cell">Status</th>
            <th class="px-4 text-xs font-bold text-gray-600 text-left whitespace-nowrap hidden xl:table-cell">Prioridade</th>
            <th class="px-4 text-xs font-bold text-gray-600 text-left whitespace-nowrap hidden xl:table-cell">Localização</th>
            <th class="px-4 text-xs font-bold text-gray-600 text-left whitespace-nowrap hidden 2xl:table-cell">Cliente(s)</th>
            <th class="px-4 text-xs font-bold text-gray-600 text-left whitespace-nowrap hidden 2xl:table-cell">Responsável(s)</th>
            
          </tr>
        </thead>
        <tbody>
          @for (ticket of tickets; track $index) {
            <tr class="h-10 border-b border-t text-gray-800 cursor-pointer hover:bg-gray-100 group">
              <td class="px-4 bg-gray-100 text-sm"><input type="checkbox" class="align-middle" [(ngModel)]="ticket.selected" (change)="onTicketSelect(ticket)"></td>
              <td class="px-4 bg-gray-100 text-sm whitespace-nowrap">{{ ticket.id }}</td>
              <td class="px-4 bg-gray-100 text-sm flex-grow overflow-hidden">
                <a class="truncate text-blue-900 font-semibold w-full" [tp]="ticket.subject" [routerLink]="['/ticket', ticket.id]">{{ ticket.subject }}</a>
              </td>
              <td class="px-4 bg-gray-100 text-sm whitespace-nowrap hidden md:table-cell">{{ ticket.createdAt }}</td>
              <td class="px-4 bg-gray-100 text-sm whitespace-nowrap hidden md:table-cell">
                <span class="inline-block w-2 h-2 rounded-full mr-1"
                  [ngClass]="{
                    'bg-blue-400': ticket.status === 'Open',
                    'bg-yellow-300': ticket.status === 'InProgress',
                    'bg-green-500': ticket.status === 'Resolved',
                    'bg-gray-400': ticket.status === 'Closed'
                  }">
                </span>
                <span>{{ statusTranslationMap[ticket.status] }}</span>
              </td>
              <td class="px-4 bg-gray-100 text-sm whitespace-nowrap hidden xl:table-cell">
                <span class="inline-block w-2 h-2 rounded-full mr-1"
                  [ngClass]="{
                    'bg-green-500': ticket.priority === 'Low',
                    'bg-orange-400': ticket.priority === 'Medium',
                    'bg-red-500': ticket.priority === 'High',
                    'bg-red-700': ticket.priority === 'Urgent'
                  }">
                </span>
                <span>{{ priorityTranslationMap[ticket.priority] }}</span>
              </td>
              <td class="px-4 bg-gray-100 text-sm whitespace-nowrap hidden xl:table-cell text-ellipsis overflow-hidden" [tp]="getFullLocation(ticket.location)">{{ getLastLocation(ticket.location) }}</td>
              <td class="px-4 bg-gray-100 text-sm whitespace-nowrap hidden 2xl:table-cell">
                <div class="flex items-center">
                  <span>{{ ticket.customers[0]?.fullName }}</span>
                  @if (ticket.customers.length > 1) {
                    <span class="ml-2 text-blue-900 rounded-full text-xs font-bold font-robotoMono">+{{ ticket.customers.length - 1 }}</span>
                  }
                </div>
              </td>
              <td class="px-4 bg-gray-100 text-sm whitespace-nowrap hidden 2xl:table-cell">
                <div class="flex items-center">
                  <span>{{ ticket.assignees[0]?.fullName }}</span>
                  @if (ticket.assignees.length > 1) {
                    <span class="ml-2 text-blue-900 rounded-full text-xs font-bold">+{{ ticket.assignees.length - 1 }}</span>
                  }
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
    <div class="border border-t-0 rounded-2xl rounded-t-none overflow-hidden">
      <phds-pagination
        [page]="page"
        [size]="size"
        [totalItems]="totalItems"
        [pageSizeOptions]="pageSizeOptions"
        (pageChange)="goToPage($event)"
        (sizeChange)="onPageSizeChange($event)"
      />
    </div>
  </div>
</div>
