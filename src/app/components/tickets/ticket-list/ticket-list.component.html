<div class="m-4">
  <div class="mx-auto w-full max-w-[1664px]">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-gray-800 text-left">Todos os Chamados ({{ tickets.length }})</h2>
      <div class="flex justify-center items-center gap-4 text-sm">
        <phds-select [placeholder]="'Status'" [options]="statusOptions" [selectedValue]="selectedStatus" (valueChange)="onStatusChange($event)"></phds-select>
        <phds-select [placeholder]="'Prioridade'" [options]="priorityOptions" [selectedValue]="selectedPriority" (valueChange)="onPriorityChange($event)"></phds-select>
      </div>
    </div>
    <div class="overflow-x-auto">
      <table class="table-auto border-collapse overflow-hidden w-full rounded-t-xl">
        <thead>
          <tr class="h-12">
            <th class="px-4 bg-white text-xs font-bold text-gray-600 text-left"><input type="checkbox" (change)="toggleAll($event)"></th>
            <th class="px-4 bg-white text-xs font-bold text-gray-600 text-left whitespace-nowrap">ID</th>
            <th class="px-4 bg-white text-xs font-bold text-gray-600 text-left w-full">Assunto</th>
            <th class="px-4 bg-white text-xs font-bold text-gray-600 text-left whitespace-nowrap">Criado em</th>
            <th class="px-4 bg-white text-xs font-bold text-gray-600 text-left whitespace-nowrap">Status</th>
            <th class="px-4 bg-white text-xs font-bold text-gray-600 text-left whitespace-nowrap">Prioridade</th>
            <th class="px-4 bg-white text-xs font-bold text-gray-600 text-left whitespace-nowrap">Localização</th>
            <th class="px-4 bg-white text-xs font-bold text-gray-600 text-left whitespace-nowrap">Cliente(s)</th>
            <th class="px-4 bg-white text-xs font-bold text-gray-600 text-left whitespace-nowrap">Responsável(s)</th>
          </tr>
        </thead>
        <tbody>
          @for (ticket of tickets; track $index) {
            <tr class="h-12 border-b border-gray-300 text-gray-800 cursor-pointer hover:bg-gray-100 group">
              <td class="px-4 bg-gray-100 text-sm"><input type="checkbox" [(ngModel)]="ticket.selected" (change)="onTicketSelect(ticket)"></td>
              <td class="px-4 bg-gray-100 text-sm whitespace-nowrap">{{ ticket.id }}</td>
              <td class="px-4 bg-gray-100 text-sm flex-grow overflow-hidden">
                <a class="truncate text-blue-900 font-semibold w-full" [tp]="ticket.subject" [routerLink]="['/ticket', ticket.id]">{{ ticket.subject }}</a>
              </td>
              <td class="px-4 bg-gray-100 text-sm whitespace-nowrap">{{ ticket.createdAt }}</td>
              <td class="px-4 bg-gray-100 text-sm whitespace-nowrap">
                <span class="inline-block w-2 h-2 rounded-full mr-1"
                  [ngClass]="{
                    'bg-blue-400': ticket.status === 'Open',
                    'bg-yellow-300': ticket.status === 'InProgress',
                    'bg-green-500': ticket.status === 'Resolved',
                    'bg-gray-400': ticket.status === 'Closed'
                  }">
                </span>
                <span>{{ statusTranslationMap[ticket.status] }}</span>
              </td>
              <td class="px-4 bg-gray-100 text-sm whitespace-nowrap">
                <span class="inline-block w-2 h-2 rounded-full mr-1"
                  [ngClass]="{
                    'bg-green-500': ticket.priority === 'Low',
                    'bg-orange-400': ticket.priority === 'Medium',
                    'bg-red-500': ticket.priority === 'High',
                    'bg-red-700': ticket.priority === 'Urgent'
                  }">
                </span>
                <span>{{ priorityTranslationMap[ticket.priority] }}</span>
              </td>
              <td class="px-4 bg-gray-100 text-sm whitespace-nowrap text-ellipsis overflow-hidden" [tp]="getFullLocation(ticket.location)">{{ getLastLocation(ticket.location) }}</td>
              <td class="px-4 bg-gray-100 text-sm whitespace-nowrap">
                <div class="flex items-center">
                  <span>{{ ticket.customers[0]?.fullName }}</span>
                  @if (ticket.customers.length > 1) {
                    <span class="ml-2 text-blue-900 rounded-full text-xs font-bold font-robotoMono">+{{ ticket.customers.length - 1 }}</span>
                  }
                </div>
              </td>
              <td class="px-4 bg-gray-100 text-sm whitespace-nowrap">
                <div class="flex items-center">
                  <span>{{ ticket.assignees[0]?.fullName }}</span>
                  @if (ticket.assignees.length > 1) {
                    <span class="ml-2 text-blue-900 rounded-full text-xs font-bold">+{{ ticket.assignees.length - 1 }}</span>
                  }
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
    <phds-pagination [page]="page" [size]="size" [totalItems]="totalItems" [pageSizeOptions]="pageSizeOptions" (pageChange)="goToPage($event)" (sizeChange)="onPageSizeChange($event)"></phds-pagination>
  </div>
  @if (isModalOpen) {
    <app-message-preview [ticket]="selectedTicket" [userId]="currentUserId" (close)="closeModal()"></app-message-preview>
  }
</div>
