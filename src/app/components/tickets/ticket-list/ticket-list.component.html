<div class="mx-auto my-5 w-fit">
  <h2 class="mb-5 text-gray-800">Todos os Chamados ({{ tickets.length }})</h2>
  <div class="mb-4 flex justify-center items-center gap-4 text-sm">
    <phds-select [options]="statusOptions" [selectedValue]="selectedStatus" (valueChange)="onStatusChange($event)"></phds-select>
    <phds-select [options]="priorityOptions" [selectedValue]="selectedPriority" (valueChange)="onPriorityChange($event)"></phds-select>
  </div>
  <table class="table-auto border-collapse w-[1664px] min-w-[1664px]">
    <thead>
      <tr class="h-10">
        <th class="px-5 py-2 bg-white text-xs font-bold text-gray-600 text-left">ID</th>
        <th class="px-5 py-2 bg-white text-xs font-bold text-gray-600 text-left">Assunto</th>
        <th class="px-5 py-2 bg-white text-xs font-bold text-gray-600 text-left">Criado em</th>
        <th class="px-5 py-2 bg-white text-xs font-bold text-gray-600 text-left">Status</th>
        <th class="px-5 py-2 bg-white text-xs font-bold text-gray-600 text-left">Prioridade</th>
        <th class="px-5 py-2 bg-white text-xs font-bold text-gray-600 text-left">Localização</th>
        <th class="px-5 py-2 bg-white text-xs font-bold text-gray-600 text-left">Cliente(s)</th>
        <th class="px-5 py-2 bg-white text-xs font-bold text-gray-600 text-left">Responsável(s)</th>
      </tr>
    </thead>
    <tbody>
      @for (ticket of tickets; track $index) {
        <tr class="border-b border-gray-300 text-gray-800 h-10 cursor-pointer hover:bg-gray-100 group">
          <td class="px-5 py-2 bg-gray-100 text-sm">{{ ticket.id }}</td>
          <td class="px-5 py-2 bg-gray-100 text-sm max-w-xs overflow-hidden">
            <div class="flex items-center justify-between">
              <a 
                class="truncate text-blue-900 font-semibold" 
                title="{{ ticket.subject }}" 
                [routerLink]="['/ticket', ticket.id]">
                {{ ticket.subject }}
              </a>
              <div title="Pré visualizar" (click)="preview(ticket)" class="ml-2 hidden group-hover:block">
                <i class="fa-solid fa-bars-staggered"></i>
              </div>
            </div>
          </td>
                
          <td class="px-5 py-2 bg-gray-100 text-sm">{{ ticket.createdAt }}</td>
          <td class="px-5 py-2 bg-gray-100 text-sm">
            <span 
              class="inline-block w-2.5 h-2.5 rounded-full mr-1"
              [ngClass]="{
                'bg-blue-400': ticket.status === 'Open',
                'bg-yellow-300': ticket.status === 'InProgress',
                'bg-green-500': ticket.status === 'Resolved',
                'bg-gray-400': ticket.status === 'Closed'
              }">
            </span>
            <span>{{ ticket.status }}</span>
          </td>
          <td class="px-5 py-2 bg-gray-100 text-sm">
            <span 
              class="inline-block w-2.5 h-2.5 rounded-full mr-1"
              [ngClass]="{
                'bg-green-500': ticket.priority === 'Low',
                'bg-orange-400': ticket.priority === 'Medium',
                'bg-red-500': ticket.priority === 'High',
                'bg-red-700': ticket.priority === 'Urgent'
              }">
            </span>
            <span>{{ ticket.priority }}</span>
          </td>
          <td class="px-5 py-2 bg-gray-100 text-sm max-w-xs overflow-hidden text-ellipsis whitespace-nowrap" title="{{ getLocationHierarchy(ticket.location) }}">
            {{ getLocationHierarchy(ticket.location) }}
          </td>
          <td class="px-5 py-2 bg-gray-100 text-sm">
            <div class="flex items-center">
              <span>{{ ticket.customers[0].fullName }}</span>
              @if (ticket.customers.length > 1) {
                <span class="ml-2 text-blue-900 rounded-full text-xs font-bold font-robotoMono">+{{ ticket.customers.length - 1 }}</span>
              }
            </div>
          </td>
          <td class="px-5 py-2 bg-gray-100 text-sm">
            <div class="flex items-center">
              <span>{{ ticket.assignees[0].fullName }}</span>
              @if (ticket.assignees.length > 1) {
                <span class="ml-2 text-blue-900 rounded-full text-xs font-bold">+{{ ticket.assignees.length - 1 }}</span>
              }
            </div>
          </td>
        </tr>
      }
    </tbody>
  </table>
  <div class="flex justify-between items-center h-16 bg-white px-5 rounded-b-2xl text-sm">
    <div class="flex items-center space-x-2">
      <label for="pageSize">Itens por página: </label>
      <phds-select [options]="pageSizeOptions" [selectedValue]="size" (valueChange)="onPageSizeChange($event)"></phds-select>
    </div>
    <div class="flex items-center space-x-2">
      <div class="mr-5">{{ paginationText }}</div>
      <div class="flex space-x-2">
        <button class="flex items-center justify-center bg-blue-500 w-8 h-8 text-white rounded-full disabled:bg-gray-400" (click)="prevPage()" [disabled]="page === 1">
          <i class="fa-solid fa-chevron-left"></i>
        </button>
        @for (pageNum of pages; track $index) {
          <button class="flex items-center justify-center bg-blue-500 w-8 h-8 text-white rounded-full disabled:bg-gray-400" (click)="goToPage(pageNum)" [disabled]="pageNum === page">{{ pageNum }}</button>
        }
        <button class="flex items-center justify-center bg-blue-500 w-8 h-8 text-white rounded-full disabled:bg-gray-400" (click)="nextPage()" [disabled]="page * size >= totalItems">
          <i class="fa-solid fa-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>
</div>
@if (isModalOpen) {
  <app-message-preview [ticket]="selectedTicket" [userId]="currentUserId" (close)="closeModal()"></app-message-preview>
}